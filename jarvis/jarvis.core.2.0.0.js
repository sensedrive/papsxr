(()=>{var e={649:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var i=n(841),r=n.n(i)()((function(e){return e[1]}));r.push([e.id,"._2GJjKeqnSHDMGutbGyU5Ee {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n}\n",""]),r.locals={innerContainer:"_2GJjKeqnSHDMGutbGyU5Ee"};const o=r},841:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=e(t);return t[2]?"@media ".concat(t[2]," {").concat(n,"}"):n})).join("")},t.i=function(e,n,i){"string"==typeof e&&(e=[[null,e,""]]);var r={};if(i)for(var o=0;o<this.length;o++){var s=this[o][0];null!=s&&(r[s]=!0)}for(var a=0;a<e.length;a++){var l=[].concat(e[a]);i&&r[l[0]]||(n&&(l[2]?l[2]="".concat(n," and ").concat(l[2]):l[2]=n),t.push(l))}},t}},440:(e,t,n)=>{"use strict";var i,r=function(){var e={};return function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}e[t]=n}return e[t]}}(),o=[];function s(e){for(var t=-1,n=0;n<o.length;n++)if(o[n].identifier===e){t=n;break}return t}function a(e,t){for(var n={},i=[],r=0;r<e.length;r++){var a=e[r],l=t.base?a[0]+t.base:a[0],c=n[l]||0,h="".concat(l," ").concat(c);n[l]=c+1;var u=s(h),d={css:a[1],media:a[2],sourceMap:a[3]};-1!==u?(o[u].references++,o[u].updater(d)):o.push({identifier:h,updater:f(d,t),references:1}),i.push(h)}return i}function l(e){var t=document.createElement("style"),i=e.attributes||{};if(void 0===i.nonce){var o=n.nc;o&&(i.nonce=o)}if(Object.keys(i).forEach((function(e){t.setAttribute(e,i[e])})),"function"==typeof e.insert)e.insert(t);else{var s=r(e.insert||"head");if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(t)}return t}var c,h=(c=[],function(e,t){return c[e]=t,c.filter(Boolean).join("\n")});function u(e,t,n,i){var r=n?"":i.media?"@media ".concat(i.media," {").concat(i.css,"}"):i.css;if(e.styleSheet)e.styleSheet.cssText=h(t,r);else{var o=document.createTextNode(r),s=e.childNodes;s[t]&&e.removeChild(s[t]),s.length?e.insertBefore(o,s[t]):e.appendChild(o)}}function d(e,t,n){var i=n.css,r=n.media,o=n.sourceMap;if(r?e.setAttribute("media",r):e.removeAttribute("media"),o&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),e.styleSheet)e.styleSheet.cssText=i;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(i))}}var g=null,m=0;function f(e,t){var n,i,r;if(t.singleton){var o=m++;n=g||(g=l(t)),i=u.bind(null,n,o,!1),r=u.bind(null,n,o,!0)}else n=l(t),i=d.bind(null,n,t),r=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)};return i(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;i(e=t)}else r()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=(void 0===i&&(i=Boolean(window&&document&&document.all&&!window.atob)),i));var n=a(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var i=0;i<n.length;i++){var r=s(n[i]);o[r].references--}for(var l=a(e,t),c=0;c<n.length;c++){var h=s(n[c]);0===o[h].references&&(o[h].updater(),o.splice(h,1))}n=l}}}},887:(e,t,n)=>{n.p=JarvisPublicPath}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var o=t[i]={id:i,exports:{}};return e[i](o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var i=t.getElementsByTagName("script");i.length&&(e=i[i.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e})(),(()=>{"use strict";n(887);var e=n(440),t=n.n(e),i=n(649);t()(i.Z,{insert:"head",singleton:!1});const r=i.Z.locals||{},o="Error";var s,a;!function(e){e.UnsupportedBrowser="UnsupportedBrowser",e.NoWebGL="NoWebGL",e.PerformanceTooLow="PerformanceTooLow"}(s||(s={}));class l{static addEventCallback(e){l.eventCallbacks.push(e)}static dispatchErrorEventWithType(e){l.dispatchEvent(o,{type:e})}static dispatchErrorEventWithMessage(e){l.dispatchEvent(o,{type:"Other",message:e})}static dispatchMeasuredLoadTimeInSecondsEvent(e){l.dispatchEvent("MeasuredLoadTimeInSeconds",{loadTimeInSeconds:e})}static dispatchLogEvent(e){l.dispatchEvent("Log",{message:e})}static dispatchEvent(e,t){for(let n of l.eventCallbacks)n(e,t)}}l.eventCallbacks=[],function(e){e[e.INFO=1]="INFO",e[e.ERROR=2]="ERROR"}(a||(a={}));const c=new class{constructor(){this.isRecording=!1,this.recordedFormattedLogEntries=[]}startRecording(){if(this.isRecording)throw new Error("Logger is already recording.");this.isRecording=!0}stopRecording(){if(!this.isRecording)throw new Error("Logger was not recording.");this.isRecording=!1}flushRecordedMessages(){if(this.isRecording)throw new Error("Logger is currently recording. You must call stopRecording first.");const e=this.recordedFormattedLogEntries;return this.recordedFormattedLogEntries=[],e}error(e){let t;t=e instanceof Error?e.message:e,this.addEntry(a.ERROR,t)}info(e){this.addEntry(a.INFO,e)}formatLogEntry(e){let t=e.date.toLocaleString();return t+=e.level===a.ERROR?" error:  ":" info: ",t+=e.message,t}addEntry(e,t){const n=this.formatLogEntry({message:t,date:new Date,level:e});this.isRecording&&this.recordedFormattedLogEntries.push(n),l.dispatchLogEvent(n)}},h={initialPosition:{lat:0,lon:0},cameraPosition:{x:0,y:0,z:0},zoomLevels:[{minWidth:0,focalLength:20},{minWidth:320,focalLength:17},{minWidth:480,focalLength:15},{minWidth:768,focalLength:12},{minWidth:1024,focalLength:10},{minWidth:1280,focalLength:8}],easeCameraFactor:.02,dragCameraSpeedAttenuation:2.2,minLat:-85,maxLat:85,minRequiredFps:30,measurePerformanceIntervalInMs:1500,preloadTextureTimeoutInMs:1e4,initialVideo:null,initialImage:null,runMode:"Free",fullscreenElement:null};class u{check(e){if("object"!=typeof e.initialPosition||"number"!=typeof e.initialPosition.lat||"number"!=typeof e.initialPosition.lon)throw new Error("Config: You must provide the initialPosition as numbers for lat and lon.");if("number"!=typeof e.minLat||e.minLat<-85||e.minLat>0)throw new Error("Config: You must provide minLat as a number between -85 and 0.");if("number"!=typeof e.maxLat||e.maxLat<0||e.maxLat>85)throw new Error("Config: You must provide maxLat as a number between 0 and 85.");if("number"!=typeof e.minRequiredFps||e.minRequiredFps<0)throw new Error("Config: You must provide minRequiredFps as a number and it must be greater than or equal to 0.");if("number"!=typeof e.measurePerformanceIntervalInMs||e.measurePerformanceIntervalInMs<0)throw new Error("Config: You must provide measurePerformanceIntervalInMs as a number and it must be greater than or equal to 0.");if("number"!=typeof e.preloadTextureTimeoutInMs||e.preloadTextureTimeoutInMs<0)throw new Error("Config: You must provide preloadTextureTimeoutInMs as a number and it must be greater than or equal to 0.");if("number"!=typeof e.easeCameraFactor||e.easeCameraFactor<0)throw new Error("Config: You must provide easeCameraFactor as a number and it must be greater than or equal to 0.");if("number"!=typeof e.dragCameraSpeedAttenuation||e.dragCameraSpeedAttenuation<0)throw new Error("Config: You must provide dragCameraSpeedAttenuation as a number and it must be greater than or equal to 0.");if(!Array.isArray(e.zoomLevels))throw new Error("Config: You must provide zoomLevels as an array.");for(let t of e.zoomLevels){if("number"!=typeof t.minWidth||t.minWidth<0)throw new Error("Config: You must provide the minWidth for a zoomLevel as a number and it must be greater than or equal to 0.");if("number"!=typeof t.focalLength||t.focalLength<0)throw new Error("Config: You must provide the focalLength for a zoomLevel as a number and it must be greater than or equal to 0.")}if("string"!=typeof e.runMode||-1===["Video360","Image360","Free"].indexOf(e.runMode))throw new Error("Config: Invalid or empty run mode.");if("Video360"===e.runMode&&null!==e.initialImage)throw new Error(`Config: Initial image not allowed for run mode ${e.runMode}.`);if("Image360"===e.runMode&&null!==e.initialVideo)throw new Error(`Config: Initial video not allowed for run mode ${e.runMode}.`);if(null!==e.initialVideo&&null!==e.initialImage)throw new Error("Config: You must set either a video, an image or none.");if(null!==e.initialVideo&&"string"!=typeof e.initialVideo.default&&("string"!=typeof e.initialVideo.mobile||"string"!=typeof e.initialVideo.tablet||"string"!=typeof e.initialVideo.desktop))throw new Error("Config: You must provide a path for either video.default or all of video.mobile, video.tablet and video.desktop");if(null!==e.initialImage&&"string"!=typeof e.initialImage.default&&("string"!=typeof e.initialImage.mobile||"string"!=typeof e.initialImage.tablet||"string"!=typeof e.initialImage.desktop))throw new Error("Config: You must provide a path for either image.default or all of image.mobile, image.tablet and image.desktop");if(null!==e.fullscreenElement&&!(e.fullscreenElement instanceof HTMLElement))throw new Error("Config: fullscreenElement must be null or an instance of HTMLElement")}}const d=new class{load(e){return t=this,n=void 0,r=function*(){return new Promise(((t,n)=>{const i=document.createElement("script");i.src=e,i.async=!0,i.addEventListener("error",(()=>{n("Could not load module "+e)})),i.addEventListener("load",(()=>{t()})),document.body.appendChild(i)}))},new((i=void 0)||(i=Promise))((function(e,o){function s(e){try{l(r.next(e))}catch(e){o(e)}}function a(e){try{l(r.throw(e))}catch(e){o(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(s,a)}l((r=r.apply(t,n||[])).next())}));var t,n,i,r}};var g=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((i=i.apply(e,t||[])).next())}))};const m=new class{constructor(){this.modules=[]}register(e,t,n){if(this.hasModuleWithName(e))throw new Error("Module "+e+" already registered");this.modules.push({name:e,path:t,rawConfig:n})}loadModules(){return g(this,void 0,void 0,(function*(){for(let e of this.modules)this.isModuleLoaded(e.name)||(c.info("Load module "+e.name),yield d.load(e.path))}))}initModules(e,t){return g(this,void 0,void 0,(function*(){for(let n of this.modules){const i=this.getLoadedModule(n.name);yield i.init(e,t,n.rawConfig)}}))}startModules(e,t){return g(this,void 0,void 0,(function*(){for(let n of this.modules){const i=this.getLoadedModule(n.name);yield i.start(e,t)}}))}hasModuleWithName(e){return void 0!==this.modules.find((t=>t.name===e))}isModuleLoaded(e){return"undefined"!=typeof Jarvis&&void 0!==Jarvis.modules&&Jarvis.modules.hasOwnProperty(e)}getLoadedModule(e){if(!this.isModuleLoaded(e))throw new Error("Module "+e+" was not loaded.");const t=Jarvis.modules[e];if("function"!=typeof t.init||"function"!=typeof t.start)throw new Error("Module "+e+" does not seem to be a valid module.");return t}};class f extends Error{constructor(e,t){super(t),this.errorEventType=e,Object.setPrototypeOf(this,f.prototype)}getErrorEventType(){return this.errorEventType}}var p=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((i=i.apply(e,t||[])).next())}))};class v{constructor(e,t){this.config=t.getConfigHelper().getCoreConfig(),this.controllerProvider=e,this.helperProvider=t}getId(){return"LoadTexture"}run(){return p(this,void 0,void 0,(function*(){null===this.config.initialVideo?null!==this.config.initialImage&&(yield this.loadImageTexture(this.config.initialImage)):yield this.loadVideoTexture(this.config.initialVideo)}))}loadVideoTexture(e){return p(this,void 0,void 0,(function*(){this.logHelper.info("Load video texture"),yield this.sceneController.loadVideoTexture(this.textureHelper.getTextureSrcFromAdaptiveConfig(e),this.config.preloadTextureTimeoutInMs)}))}loadImageTexture(e){return p(this,void 0,void 0,(function*(){this.logHelper.info("Preload image for texture");const t=yield this.textureHelper.preloadTexture(this.textureHelper.getTextureSrcFromAdaptiveConfig(e),this.config.preloadTextureTimeoutInMs);this.logHelper.info("Load image texture"),yield this.sceneController.loadImageTexture(t)}))}get logHelper(){return this.helperProvider.getLogHelper()}get textureHelper(){return this.helperProvider.getTextureHelper()}get sceneController(){return this.controllerProvider.getSceneController()}}class E{static notifyAboutEvent(e,t){if(void 0!==E.listeners[e])for(let n of E.listeners[e])n(t)}static registerForEvent(e,t){void 0===E.listeners[e]&&(E.listeners[e]=[]),E.listeners[e].push(t)}}E.listeners={};class w{dispatchMeasuredLoadTimeInSecondsEvent(e){l.dispatchMeasuredLoadTimeInSecondsEvent(e)}dispatchErrorEventWithMessage(e){l.dispatchErrorEventWithMessage(e)}dispatchEvent(e,t){void 0===t&&(t={}),l.dispatchEvent(e,t)}addEventListener(e,t){E.registerForEvent(e,t)}}var C=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((i=i.apply(e,t||[])).next())}))};class L{constructor(e,t){this.controllerProvider=e,this.helperProvider=t}getId(){return"RegisterCallbacks"}run(){return C(this,void 0,void 0,(function*(){const e=this.controllerProvider.getCameraMovementController(),t=this.controllerProvider.getUpdateLoopController(),n=this.controllerProvider.getCameraController(),i=this.controllerProvider.getSceneController(),r=this.controllerProvider.getSceneObjectTrackingController(),o=this.controllerProvider.getStartupController(),s=this.helperProvider.getDomHelper(),a=this.helperProvider.getLogHelper(),l=this.helperProvider.getEventHelper();a.info("Register callbacks"),this.helperProvider.getWindowHelper().addResizeFunction((()=>{n.resize(s.getWidth(),s.getHeight()),i.getRenderer().setSize(s.getWidth(),s.getHeight())})),t.registerUpdateFunction((()=>{n.updateEasing(),i.renderWithCamera(n.getCamera())})),this.helperProvider.getWindowHelper().addBlurFunction((n=>{if(n.startStepContext={cameraMovementControllerRunning:e.isRunning(),updateLoopControllerRunning:t.isRunning(),sceneObjectTrackingControllerRunning:r.isRunning(),texturePlaying:!0},e.stop(),t.stop(),i.hasVideoControls()){const e=i.getVideoControls();n.startStepContext.texturePlaying=e.isPlaying(),e.pause()}})),this.helperProvider.getWindowHelper().addFocusFunction((n=>{void 0===n.startStepContext&&(n.startStepContext={cameraMovementControllerRunning:!1,updateLoopControllerRunning:!1,sceneObjectTrackingControllerRunning:!1,texturePlaying:!0}),n.startStepContext.cameraMovementControllerRunning&&e.start(),n.startStepContext.updateLoopControllerRunning&&t.start(),n.startStepContext.sceneObjectTrackingControllerRunning&&r.start(),i.hasVideoControls()&&n.startStepContext.texturePlaying&&i.getVideoControls().play()})),o.registerOnStartCallback((()=>C(this,void 0,void 0,(function*(){if(n.resize(s.getWidth(),s.getHeight()),yield e.enableMouseTouch(),i.hasVideoControls()){const e=i.getVideoControls();e.resetToPosition(0),yield e.play()}e.start(),t.start(),r.start()})))),l.addEventListener("EnterFullscreen",(()=>{s.enterFullscreen()})),l.addEventListener("LeaveFullscreen",(()=>{s.leaveFullscreen()})),s.addFullscreenChangeEventCallback((e=>{e?l.dispatchEvent("EnteredFullscreen"):l.dispatchEvent("LeftFullscreen")}))}))}}const b=n.p+"videos/check.fba91bb.mp4",y=n.p+"images/check.f9c31b9.png";var F=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((i=i.apply(e,t||[])).next())}))};class x{constructor(e,t){this.config=t.getConfigHelper().getCoreConfig(),this.controllerProvider=e,this.helperProvider=t}getId(){return"CheckEnvironment"}run(){return F(this,void 0,void 0,(function*(){this.logHelper.info("Check environment"),yield this.check()}))}check(){return F(this,void 0,void 0,(function*(){switch(this.logHelper.info("Check performance"),this.config.runMode){case"Video360":return void(yield this.checkIfVideoTextureCanBeUsed());case"Image360":return void(yield this.checkIfImageTextureCanBeUsed());case"Free":return yield this.checkIfVideoTextureCanBeUsed(),void(yield this.checkIfImageTextureCanBeUsed())}}))}checkIfVideoTextureCanBeUsed(){return F(this,void 0,void 0,(function*(){yield this.sceneController.loadVideoTexture(b);const e=yield this.measureFpsAndCheckForWebGLErrors();if(this.logHelper.info(`Measured ${e} fps when using video texture.`),this.sceneController.removeTexture(),e<this.helperProvider.getFpsHelper().getMinimumRequiredFps())throw new f(s.PerformanceTooLow,`Performance for video texture is not sufficient. Measured fps were ${e}.`)}))}checkIfImageTextureCanBeUsed(){return F(this,void 0,void 0,(function*(){yield this.sceneController.loadImageTexture(y);const e=yield this.measureFpsAndCheckForWebGLErrors();if(this.logHelper.info(`Measured ${e} fps when using image texture.`),this.sceneController.removeTexture(),e<this.helperProvider.getFpsHelper().getMinimumRequiredFps())throw new f(s.PerformanceTooLow,`Performance for image texture is not sufficient. Measured fps were ${e}.`)}))}measureFpsAndCheckForWebGLErrors(){return F(this,void 0,void 0,(function*(){return new Promise(((e,t)=>F(this,void 0,void 0,(function*(){try{const n=this.controllerProvider.getUpdateLoopController(),i=this.controllerProvider.getCameraController(),r=this.controllerProvider.getSceneController();if(this.sceneController.hasVideoControls()){const e=this.sceneController.getVideoControls();e.resetToPosition(0),yield e.play()}const o=()=>{r.renderWithCamera(i.getCamera())};n.registerUpdateFunction(o),n.start();const s=this.helperProvider.getFpsHelper(),a=[];let l=10;const c=()=>{if(s.stopMeasureLoop(h),this.sceneController.hasVideoControls()){const e=this.sceneController.getVideoControls();e.resetToPosition(0),e.pause()}n.unregisterUpdateFunction(o),n.stop()};let h=s.startMeasureLoop(this.helperProvider.getConfigHelper().getCoreConfig().measurePerformanceIntervalInMs/l,(n=>{const i=this.sceneController.getWebGLContext(),r=i.getError();if(r!==i.NO_ERROR)return c(),void t("Error while rendering. WebGL context has error: "+r);if(l--,a.push(n),l<=0){c();let t=this.helperProvider.getMathHelper().filterMinMaxNumbersFromArray(a,1),n=this.helperProvider.getMathHelper().calculateAverage(t);e(n)}}))}catch(e){t(e)}}))))}))}get sceneController(){return this.controllerProvider.getSceneController()}get startupController(){return this.controllerProvider.getStartupController()}get logHelper(){return this.helperProvider.getLogHelper()}}const M=THREE;class k extends M.EventDispatcher{constructor(e,t,n){super(),this.lat=0,this.lon=0,this.lookAt=new M.Vector3,this.minLat=e.minLat,this.maxLat=e.maxLat,this.camera=t,this.mathHelper=n,this.baseFocalLength=0,this.focalLengthOffset=0,this.zoomLevels=e.zoomLevels,this.easing={isEasing:!1,nextLookAt:{lat:null,lon:null},direction:{lat:0,lon:0},easeFactor:e.easeCameraFactor,stopThreshold:1},this.fieldOfView={verticalInDegrees:0,verticalInRad:0,horizontalInDegrees:0,horizontalInRad:0},this.camera.position.set(e.cameraPosition.x,e.cameraPosition.y,e.cameraPosition.z),this.updateLookAt(e.initialPosition.lat,e.initialPosition.lon)}updateEasing(){if(!1===this.easing.isEasing||null===this.easing.nextLookAt.lat||null===this.easing.nextLookAt.lon)return;let e=this.mathHelper.calculateDistanceBetweenLatLonPoints({lat:this.lat,lon:this.lon},this.easing.nextLookAt);if(e.lat<=this.easing.stopThreshold&&e.lon<=this.easing.stopThreshold)return void this.stopEasing();let t=this.easing.direction.lat*e.lat*this.easing.easeFactor,n=this.easing.direction.lon*e.lon*this.easing.easeFactor;this.setNewLatLon(this.lat+t,this.lon+n)}isEasing(){return this.easing.isEasing}stopEasing(){this.easing.isEasing=!1,this.resetEasingNextLookAtLat(),this.resetEasingNextLookAtLon(),this.easing.direction.lat=0,this.easing.direction.lon=0}updateLookAtDeltaWithEasing(e,t){let n=this.easing.direction.lat,i=this.easing.direction.lon;e>0?this.easing.direction.lat=1:e<0&&(this.easing.direction.lat=-1),t>0?this.easing.direction.lon=1:t<0&&(this.easing.direction.lon=-1),n!==this.easing.direction.lat&&this.resetEasingNextLookAtLat(),i!==this.easing.direction.lon&&this.resetEasingNextLookAtLon(),null===this.easing.nextLookAt.lat&&(this.easing.nextLookAt.lat=this.lat),null===this.easing.nextLookAt.lon&&(this.easing.nextLookAt.lon=this.lon),this.easing.nextLookAt={lat:this.restrictLatToMinMax(this.easing.nextLookAt.lat+e),lon:this.mathHelper.normalizeLon(this.easing.nextLookAt.lon+t)},this.easing.isEasing=!0}updateLookAt(e,t){this.stopEasing(),this.setNewLatLon(e,t)}updateLookAtDelta(e,t){this.updateLookAt(this.lat+e,this.lon+t)}resize(e,t){let n=e/t;this.camera.aspect=n,this.camera.updateProjectionMatrix();let i=0;for(let t of this.zoomLevels)e>=t.minWidth&&(i=t.focalLength);this.baseFocalLength=i,this.applyFocalLength()}getOrientation(){return{lookAt:{lat:this.lat,lon:this.lon,vector:this.lookAt},position:this.camera.position,rotation:this.camera.rotation}}setOrientation(e){this.lat=e.lookAt.lat,this.lon=e.lookAt.lon,this.lookAt=e.lookAt.vector,this.camera.position.copy(e.position),this.camera.rotation.copy(e.rotation),this.dispatchEvent(Object.assign({type:"updateOrientation"},e))}getFocalLength(){return this.camera.getFocalLength()}getFieldOfView(){return this.fieldOfView}setFieldOfView(e){this.fieldOfView=e,this.dispatchEvent(Object.assign({type:"updateFieldOfView"},this.fieldOfView))}resetFieldOfViewFromInternalCamera(){this.updateFieldOfView()}getCamera(){return this.camera}setNewLatLon(e,t){this.lat=this.restrictLatToMinMax(e),this.lon=this.mathHelper.normalizeLon(t),this.lookAt=this.mathHelper.calculatePositionOnSphereFromLatLon(this.lat,this.lon,1),this.camera.lookAt(this.lookAt),this.dispatchEvent({type:"updateOrientation",lookAt:{lat:this.lat,lon:this.lon,vector:this.lookAt},position:this.camera.position,rotation:this.camera.rotation})}resetEasingNextLookAtLat(){this.easing.nextLookAt.lat=null}resetEasingNextLookAtLon(){this.easing.nextLookAt.lon=null}applyFocalLength(){let e=this.baseFocalLength+this.focalLengthOffset;this.camera.setFocalLength(e),this.updateFieldOfView()}updateFieldOfView(){this.fieldOfView.verticalInDegrees=this.camera.getEffectiveFOV(),this.fieldOfView.verticalInRad=M.MathUtils.degToRad(this.fieldOfView.verticalInDegrees),this.fieldOfView.horizontalInDegrees=this.fieldOfView.verticalInDegrees*this.camera.aspect,this.fieldOfView.horizontalInRad=M.MathUtils.degToRad(this.fieldOfView.horizontalInDegrees),this.dispatchEvent(Object.assign({type:"updateFieldOfView"},this.fieldOfView))}restrictLatToMinMax(e){return Math.max(this.minLat,Math.min(this.maxLat,e))}}class T{constructor(e,t,n,i,r){this.startMouseTouch=e=>{this.cameraController.stopEasing()},this.moveMouseTouch=e=>{this.cameraController.updateLookAtDeltaWithEasing(e.deltaY/this.dragSpeedAttenuation,-e.deltaX/this.dragSpeedAttenuation)},this.containerMouseTouchInput=e,this.cameraController=t,this.dragSpeedAttenuation=n,this.mathHelper=i,this.detectorHelper=r,this.is={mouseTouchEnabled:!1,running:!1}}start(){this.is.running||(this.containerMouseTouchInput.enable(),this.is.running=!0)}stop(){this.is.running&&(this.containerMouseTouchInput.disable(),this.is.running=!1)}isRunning(){return this.is.running}enableMouseTouch(){return e=this,t=void 0,i=function*(){this.is.mouseTouchEnabled||(this.containerMouseTouchInput.addEventListener("drag",this.moveMouseTouch),this.containerMouseTouchInput.addEventListener("dragStart",this.startMouseTouch),this.is.mouseTouchEnabled=!0)},new((n=void 0)||(n=Promise))((function(r,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((i=i.apply(e,t||[])).next())}));var e,t,n,i}disableMouseTouch(){this.is.mouseTouchEnabled&&(this.containerMouseTouchInput.removeEventListener("drag",this.moveMouseTouch),this.containerMouseTouchInput.removeEventListener("dragStart",this.startMouseTouch),this.is.mouseTouchEnabled=!1)}getContainerMouseTouchInput(){return this.containerMouseTouchInput}}class P{constructor(e){this.renderer=e,this.updateFunctions=[],this.is={running:!1}}registerUpdateFunction(e){this.updateFunctions.push(e)}unregisterUpdateFunction(e){this.updateFunctions=this.updateFunctions.filter((t=>t!==e))}start(){this.is.running=!0,this.renderer.setAnimationLoop(((e,t)=>{for(let n of this.updateFunctions)n(e,t)}))}stop(){this.is.running=!1,this.renderer.setAnimationLoop(null)}isRunning(){return this.is.running}}class I extends M.EventDispatcher{constructor(e){super(),this.onTouchMove=e=>{e.preventDefault();const t=e.touches[0];document.elementFromPoint(t.pageX,t.pageY)!==e.target?this.dragEnd():this.drag(e.touches[0])},this.onTouchStart=e=>{this.dragStart(e.touches[0]),this.click()},this.onTouchEnd=e=>{this.dragEnd()},this.onMouseDown=e=>{e.preventDefault(),this.dragStart(e),this.click()},this.onMouseUp=e=>{this.drag(e),this.dragEnd()},this.onMouseMove=e=>{this.drag(e)},this.onMouseLeave=e=>{this.dragEnd()},this.dragStart=e=>{this.is.dragging&&this.dragEnd(),this.is.dragging=!0,this.lastDragPosition.x=e.pageX,this.lastDragPosition.y=e.pageY;let t=this.lastDragPosition.x,n=this.lastDragPosition.y;this.dispatchEvent({type:"dragStart",deltaX:t,deltaY:n})},this.drag=e=>{if(this.is.dragging){let t=e.pageX-this.lastDragPosition.x,n=e.pageY-this.lastDragPosition.y;this.lastDragPosition.x=e.pageX,this.lastDragPosition.y=e.pageY,this.dispatchEvent({type:"drag",deltaX:t,deltaY:n})}},this.dragEnd=()=>{this.is.dragging&&(this.is.dragging=!1,this.dispatchEvent({type:"dragEnd"}))},this.click=()=>{this.dispatchEvent({type:"click"})},this.container=e,this.is={enabled:!1,dragging:!1},this.lastDragPosition={x:0,y:0}}enable(){!0!==this.is.enabled&&(this.container.addEventListener("mousemove",this.onMouseMove),this.container.addEventListener("touchmove",this.onTouchMove),this.container.addEventListener("mousedown",this.onMouseDown),this.container.addEventListener("touchstart",this.onTouchStart),this.container.addEventListener("mouseup",this.onMouseUp),this.container.addEventListener("touchend",this.onTouchEnd),this.container.addEventListener("mouseleave",this.onMouseLeave),this.is.dragging=!1,this.is.enabled=!0)}disable(){!1!==this.is.enabled&&(this.container.removeEventListener("mousemove",this.onMouseMove),this.container.removeEventListener("touchmove",this.onTouchMove),this.container.removeEventListener("mousedown",this.onMouseDown),this.container.removeEventListener("touchstart",this.onTouchStart),this.container.removeEventListener("mouseup",this.onMouseUp),this.container.removeEventListener("touchend",this.onTouchEnd),this.container.removeEventListener("mouseleave",this.onMouseLeave),this.is.dragging=!1,this.is.enabled=!1)}isDragging(){return this.is.dragging}}class S{constructor(e){this.src=e,this.domElement=this.createDomElement()}load(e){return t=this,n=void 0,r=function*(){return new Promise(((t,n)=>{try{const i=this.createTexture();let r;this.domElement.src=this.src,this.domElement.onerror=e=>{"string"==typeof e?n(e):e instanceof ErrorEvent?n(e.error):n("Error while loading video.")},this.domElement.onprogress=()=>{console.log("number of time ranges "+this.domElement.buffered.length+" start "+this.domElement.buffered.start(0)+" end "+this.domElement.buffered.end(0)),console.log(this.domElement.duration)},e&&(r=window.setTimeout((()=>{this.domElement.src="",n("Could not load video texture. Received timout while loading video.")}),e)),this.domElement.oncanplaythrough=()=>{console.log("can play through"),this.domElement.oncanplaythrough=null,r&&window.clearTimeout(r),t(i)},this.domElement.load()}catch(e){n(e)}}))},new((i=void 0)||(i=Promise))((function(e,o){function s(e){try{l(r.next(e))}catch(e){o(e)}}function a(e){try{l(r.throw(e))}catch(e){o(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(s,a)}l((r=r.apply(t,n||[])).next())}));var t,n,i,r}getDomElement(){return this.domElement}createTexture(){let e=new M.VideoTexture(this.domElement);return e.minFilter=M.LinearFilter,e.magFilter=M.LinearFilter,e.format=M.RGBFormat,e}createDomElement(){const e=document.createElement("video");return e.style.display="none",e.loop=!1,e.muted=!0,e.setAttribute("crossorigin","anonymous"),e.setAttribute("playsinline","true"),e.setAttribute("muted","true"),e.setAttribute("preload","auto"),e}}class R{constructor(e){this.src=e}load(){return e=this,t=void 0,i=function*(){return new Promise(((e,t)=>{(new M.TextureLoader).load(this.src,(t=>{t.minFilter=M.LinearFilter,t.magFilter=M.LinearFilter,t.format=M.RGBFormat,t.wrapS=t.wrapT=M.RepeatWrapping,t.repeat.set(1,1),e(t)}),void 0,(()=>{t("Could load image texture")}))}))},new((n=void 0)||(n=Promise))((function(r,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((i=i.apply(e,t||[])).next())}));var e,t,n,i}}var H=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((i=i.apply(e,t||[])).next())}))};class O{constructor(e){this.is={playing:!1},this.updatePositionEventListeners=[],this.videoElement=e,this.is.playing=!1}pause(){this.is.playing&&(this.videoElement.pause(),this.is.playing=!1)}play(){return H(this,void 0,void 0,(function*(){this.is.playing||(yield this.videoElement.play(),this.is.playing=!0)}))}mute(){this.videoElement.muted=!0}unmute(){this.videoElement.muted=!1}isPlaying(){return this.is.playing}setPlaybackRate(e){this.videoElement.playbackRate=e}getPlaybackRate(){return this.videoElement.playbackRate}resetToPosition(e){let t=this.videoElement.duration;isNaN(t)&&(t=0);let n=Math.max(0,Math.min(t,e));this.videoElement.currentTime=n}getVideoPositionInSeconds(){return this.videoElement.currentTime}setPositionUpdateListener(e){this.videoElement.ontimeupdate=()=>{e(this.getVideoPositionInSeconds())}}unsetPositionUpdateListener(){this.videoElement.ontimeupdate=null}setEndedListener(e){this.videoElement.onended=()=>H(this,void 0,void 0,(function*(){yield e()}))}unsetEndedListener(){this.videoElement.onended=null}}var D=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((i=i.apply(e,t||[])).next())}))};class A{constructor(e,t,n,i,r){this.renderer=e,this.scene=t,this.panorama=n,this.container=i,this.runMode=r,this.texture=null,this.videoControls=null,this.scene.add(this.panorama)}getWebGLContext(){return this.renderer.getContext()}getRenderer(){return this.renderer}hasVideoControls(){return this.videoControls instanceof O}getVideoControls(){if(null===this.videoControls)throw new Error("Scene has no video controls. Check with hasVideoControls() first!");return this.videoControls}loadVideoTexture(e,t){return D(this,void 0,void 0,(function*(){if("Image360"===this.runMode)throw new Error(`Cannot load video texture. Run mode is ${this.runMode}.`);const n=new S(e);this.container.appendChild(n.getDomElement()),this.panorama.setTexture(yield n.load(t)),this.texture=n,this.videoControls=new O(n.getDomElement())}))}loadImageTexture(e){return D(this,void 0,void 0,(function*(){if("Video360"===this.runMode)throw new Error(`Cannot load image texture. Run mode is ${this.runMode}.`);const t=new R(e);this.panorama.setTexture(yield t.load()),this.texture=t,this.videoControls=null}))}removeTexture(){this.texture instanceof S&&this.container.removeChild(this.texture.getDomElement()),this.texture=null,this.videoControls=null,this.panorama.clearTexture()}renderWithCamera(e){this.renderer.render(this.scene,e)}addToScene(e){this.scene.add(e)}removeFromScene(e){this.scene.remove(e)}getRadius(){return this.panorama.getRadius()}}class V extends M.Object3D{constructor(){super(),this.radius=400;let e=new M.SphereGeometry(this.radius,80,50);e.applyMatrix4((new M.Matrix4).makeScale(-1,1,1)),this.material=new M.MeshBasicMaterial,this.add(new M.Mesh(e,this.material))}setTexture(e){this.material.map=e}clearTexture(){this.material.map=null}getRadius(){return this.radius}}class j{constructor(){this.runtime=null}setRuntime(e){if(null!==this.runtime)throw new Error("Runtime was already set!");this.runtime=e}registerOnStartCallback(e){if(null===this.runtime)throw new Error("Runtime was not set! Call setRuntime() first.");this.runtime.registerOnStartCallback(e)}}var z=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((i=i.apply(e,t||[])).next())}))};class W extends M.EventDispatcher{constructor(){super(...arguments),this.trackingInputs=[],this.running=!1,this.trackers={},this.hasObjects=!1,this.emitting=!1}addObject3DTrackingInput(e){e.addClickEventListener((e=>z(this,void 0,void 0,(function*(){yield this.emitTrackers(e),this.dispatchEvent(e)})))),e.addHoverStartEventListener((e=>z(this,void 0,void 0,(function*(){yield this.emitTrackers(e),this.dispatchEvent(e)})))),e.addHoverEndEventListener((e=>z(this,void 0,void 0,(function*(){yield this.emitTrackers(e),this.dispatchEvent(e)})))),this.trackingInputs.push(e)}start(){this.running||(this.hasObjects&&this.trackingInputs.forEach((e=>{e.enable()})),this.running=!0)}stop(){this.running&&(this.trackingInputs.forEach((e=>{e.disable()})),this.running=!1)}isRunning(){return this.running}trackObject(e,t){if(void 0!==this.trackers[e.id])throw new Error("Object with id "+e.id+" already tracked.");t&&(this.trackers[e.id]=t),this.trackingInputs.forEach((t=>{t.addObject(e)})),this.hasObjects=!0,this.running&&this.trackingInputs.forEach((e=>{e.enable()}))}removeTrackerForObject(e){void 0!==this.trackers[e.id]&&(delete this.trackers[e.id],this.trackingInputs.forEach((t=>{t.removeObject(e)})),Object.keys.length<=0&&(this.hasObjects=!1),this.running&&!this.hasObjects&&this.trackingInputs.forEach((e=>{e.disable()})))}emitTrackers(e){return z(this,void 0,void 0,(function*(){if(void 0!==this.trackers[e.targetObject.id]&&!this.emitting)try{const t=this.trackers[e.targetObject.id];this.emitting=!0,"click"===e.type&&t.click?yield t.click():"hoverStart"===e.type&&t.hoverStart?yield t.hoverStart():"hoverEnd"===e.type&&t.hoverEnd&&(yield t.hoverEnd())}catch(e){throw e}finally{this.emitting=!1}}))}}class q extends M.EventDispatcher{constructor(e,t,n,i){super(),this.objects=[],this.currentHoverObjects=[],this.mousemove=e=>{null!==e.target&&(this.mousePosition=this.calculateMousePosition(e.clientX,e.clientY))},this.click=e=>{null!==e.target&&this.clickOrTouch(e.clientX,e.clientY)},this.touch=e=>{1===e.touches.length&&null!==e.target&&this.clickOrTouch(e.touches[0].clientX,e.touches[0].clientY)},this.updateHover=()=>{if(this.isEnabled){if(null!==this.mousePosition){const e=this.calculateIntersections(this.mousePosition);for(let t of e){let e=!0;for(let n of this.currentHoverObjects)t.object===n&&(e=!1);e&&this.dispatchEvent({type:"hoverStart",targetObject:t.object})}for(let t of this.currentHoverObjects){let n=!0;for(let i of e)t===i.object&&(n=!1);n&&this.dispatchEvent({type:"hoverEnd",targetObject:t})}this.currentHoverObjects=[];for(let t of e)this.currentHoverObjects.push(t.object)}requestAnimationFrame(this.updateHover)}},this.container=e,this.cameraController=t,this.positionHelper=n,this.raycaster=i,this.isEnabled=!1,this.mousePosition=null}addClickEventListener(e){this.addEventListener("click",e)}addHoverStartEventListener(e){this.addEventListener("hoverStart",e)}addHoverEndEventListener(e){this.addEventListener("hoverEnd",e)}addObject(e){this.objects.push(e)}removeObject(e){const t=this.objects.indexOf(e);t>-1&&this.objects.splice(t,1)}enable(){this.isEnabled||(this.mousePosition=null,this.currentHoverObjects=[],this.container.addEventListener("mousemove",this.mousemove),this.container.addEventListener("mousedown",this.click),this.container.addEventListener("touchstart",this.touch),this.isEnabled=!0,this.updateHover())}disable(){this.isEnabled&&(this.container.removeEventListener("mousemove",this.mousemove),this.container.removeEventListener("mousedown",this.click),this.container.removeEventListener("touchstart",this.touch),this.isEnabled=!1)}clickOrTouch(e,t){const n=this.calculateMousePosition(e,t);if(null===n)return;const i=this.calculateIntersections(n);if(0!==i.length)for(let e of i)this.dispatchEvent({type:"click",targetObject:e.object})}calculateMousePosition(e,t){return void 0===e||void 0===t?null:this.positionHelper.calculateNormalizedContainerCoordinatesFromClientScreenCoordinates({x:e,y:t})}calculateIntersections(e){return this.raycaster.setFromCamera(e,this.cameraController.getCamera()),this.raycaster.intersectObjects(this.objects)}}class N{constructor(e,t,n){this.instances={},this.registeredCreateFunctions={},this.container=e,this.coreConfig=t,this.helperProvider=n}getCameraController(){return this.getInstance("CameraController",(()=>{const e=new M.PerspectiveCamera(50,this.container.clientWidth/this.container.clientHeight,.1,1e3);return new k(this.coreConfig,e,this.helperProvider.getMathHelper())}))}getCameraMovementController(){return this.getInstance("CameraMovementController",(()=>{let e=new I(this.container);return new T(e,this.getCameraController(),this.coreConfig.dragCameraSpeedAttenuation,this.helperProvider.getMathHelper(),this.helperProvider.getDetectorHelper())}))}getUpdateLoopController(){return this.getInstance("UpdateLoopController",(()=>{const e=this.getSceneController().getRenderer();return new P(e)}))}getSceneController(){return this.getInstance("SceneController",(()=>{const e=new M.WebGLRenderer({antialias:!0});return e.setPixelRatio(window.devicePixelRatio),e.setSize(this.container.clientWidth,this.container.clientHeight),new A(e,new M.Scene,new V,this.container,this.coreConfig.runMode)}))}getSceneObjectTrackingController(){return this.getInstance("SceneObjectTrackingController",(()=>{const e=new q(this.container,this.getCameraController(),this.helperProvider.getPositionHelper(),new M.Raycaster),t=new W;return t.addObject3DTrackingInput(e),t}))}getStartupController(){return this.getInstance("StartupController",(()=>new j))}register(e,t){if(void 0!==this.registeredCreateFunctions[e])throw new Error("Controller with name "+e+" already registered.");this.registeredCreateFunctions[e]=t}get(e){if(void 0===this.registeredCreateFunctions[e])throw new Error("Controller with name "+e+" not registered.");return this.getInstance(e,this.registeredCreateFunctions[e])}getInstance(e,t){if(this.hasInstance(e))return this.instances[e];let n=t();return this.instances[e]=n,n}hasInstance(e){return void 0!==this.instances[e]}}class U{constructor(e){this.environmentDetector=e}isMobileDevice(){return this.environmentDetector.isMobileDevice()}isTabletDevice(){return this.environmentDetector.isTabletDevice()}}class B{constructor(e){this.countFrame=e=>{if(!0!==this.measureLoops[e].running)return;this.measureLoops[e].currentIntervalFramesCount++;let t=Date.now(),n=t-this.measureLoops[e].currentIntervalStartTime;if(n>this.measureLoops[e].intervalLength){let i=Math.floor(this.measureLoops[e].currentIntervalFramesCount/n*1e3);this.measureLoops[e].currentIntervalStartTime=t,this.measureLoops[e].currentIntervalFramesCount=0,"function"==typeof this.measureLoops[e].intervalCallback&&this.measureLoops[e].intervalCallback(i)}requestAnimationFrame((()=>{this.countFrame(e)}))},this.nextMeasureLoopId=1,this.measureLoops={},this.minimumRequiredFps=e}getMinimumRequiredFps(){return this.minimumRequiredFps}startMeasureLoop(e,t){let n=this.nextMeasureLoopId;return this.measureLoops[n]={running:!0,intervalLength:e,intervalCallback:t,currentIntervalFramesCount:0,currentIntervalStartTime:Date.now()},requestAnimationFrame((()=>{this.countFrame(n)})),this.nextMeasureLoopId++,n}stopMeasureLoop(e){if(void 0===this.measureLoops[e])throw new Error("Could not find measure loop id.");this.measureLoops[e].running=!1}}class Y{constructor(){this.sphere=new M.Sphere(new M.Vector3(0,0,0),1)}calculateAverage(e){return 0===e.length?0:e.reduce(((e,t)=>e+t),0)/e.length}filterMinMaxNumbersFromArray(e,t){if(e.length<=2*t)return e;let n=e[0],i=e[0];for(let t of e)t<n&&(n=t),t>i&&(i=t);let r=0,o=0;return e.filter((e=>{let s=!0;return e<=n&&r<t&&(r++,s=!1),e>=i&&o<t&&(o++,s=!1),s}))}calculatePositionOnSphereFromLatLon(e,t,n){let i=M.MathUtils.degToRad(90-e),r=M.MathUtils.degToRad(t),o=new M.Vector3;return o.x=n*Math.sin(i)*Math.cos(r),o.y=n*Math.cos(i),o.z=n*Math.sin(i)*Math.sin(r),o}calculateLatLonFromPositionOnSphere(e,t){let n=Math.acos(e.y/t),i=90-M.MathUtils.radToDeg(n),r=Math.atan2(e.x,e.z);return{lat:i,lon:(-1*M.MathUtils.radToDeg(r)+450)%360}}calculateLatLonFromScreenCoordinates(e,t){let n=this.calculatePositionOnSphereFromNormalizedScreenCoordinates(e,t);return this.calculateLatLonFromPositionOnSphere(n,this.sphere.radius)}calculateDistanceBetweenLatLonPoints(e,t){let n=this.normalizeLon(Math.abs(e.lon-t.lon));n>180&&(n=360-n);let i=this.normalizeLat(e.lat),r=this.normalizeLat(t.lat);return{lat:Math.abs(r-i),lon:n}}calculateLonDistance(e,t){let n=this.normalizeLon(Math.abs(e-t));return n>180&&(n=360-n),n}calculateNewLonPositionWithShortestDistanceBetweenLonPositions(e,t){let n,i;return e>t?(n=e-t,i=-1):(n=t-e,i=1),n=this.normalizeLon(n),n>180&&(n=360-n,i*=-1),e+n*i}normalizeLon(e){let t=e%360;return t<0&&(t+=360),t}doRangesOverlap(e,t){return!(e.to<t.from||t.to<e.from)&&(e.from<=t.from?e.to>=t.from:e.from<=t.to)}normalizeLat(e){return Math.min(90,Math.max(-90,e))}calculatePositionOnSphereFromNormalizedScreenCoordinates(e,t){let n=new M.Raycaster;n.setFromCamera(t,e);let i=new M.Vector3;return n.ray.intersectSphere(this.sphere,i),i}}class G{constructor(e){this.domHelper=e}calculateNormalizedContainerCoordinatesFromClientScreenCoordinates(e){const t=this.domHelper.getOffsets(),n=this.domHelper.getWidth(),i=this.domHelper.getHeight();return{x:(e.x-t.left)/n*2-1,y:-(e.y-t.top)/i*2+1}}}class X{constructor(){this.callResizeFunctions=()=>{for(let e of this.resizeFunctions)e()},this.callBlurFunctions=()=>{this.blurContext={};for(let e of this.blurFunctions)e(this.blurContext)},this.callFocusFunctions=()=>{for(let e of this.focusFunctions)e(this.blurContext)},this.customEventPolyfill(),this.addOptimizedResizeListener("optimizedResize"),window.addEventListener("optimizedResize",this.callResizeFunctions),window.addEventListener("blur",this.callBlurFunctions),window.addEventListener("focus",this.callFocusFunctions),this.resizeFunctions=[],this.blurFunctions=[],this.focusFunctions=[],this.blurContext={}}addResizeFunction(e){this.resizeFunctions.push(e)}removeResizeFunction(e){this.resizeFunctions=this.resizeFunctions.filter((t=>t!==e))}addBlurFunction(e){this.blurFunctions.push(e)}addFocusFunction(e){this.focusFunctions.push(e)}addOptimizedResizeListener(e){!function(){let t=!1;window.addEventListener("resize",(()=>{t||(t=!0,requestAnimationFrame((()=>{window.dispatchEvent(new CustomEvent(e)),t=!1})))}))}()}customEventPolyfill(){!function(){function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};let n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}"function"!=typeof window.CustomEvent&&(e.prototype=window.Event.prototype,window.CustomEvent=e)}()}}class ${loadBlobFromUrl(e,t,n){return new Promise(((i,r)=>{let o=new XMLHttpRequest;o.open("GET",e,!0),o.responseType="blob",o.timeout=t,o.addEventListener("timeout",(()=>{r("Error in xhr request (timeout).")})),o.addEventListener("error",(()=>{r("Error in xhr request (error).")})),o.addEventListener("abort",(()=>{r("Error in xhr request (abort).")})),"function"==typeof n&&o.addEventListener("progress",(e=>{let t=e.loaded/e.total*100;n(t)})),o.addEventListener("load",(()=>{404!==o.status?i(o.response):r("Error in xhr request (404 not found).")})),o.send()}))}}const J=bowser;class _{constructor(){this.platformDetails=null}isMobileDevice(){return"mobile"===this.getPlatformDetails().type}isTabletDevice(){return"tablet"===this.getPlatformDetails().type}getPlatformDetails(){return null===this.platformDetails&&(this.platformDetails=J.parse(window.navigator.userAgent).platform),this.platformDetails}}class Z{constructor(e,t,n){this.detectorHelper=t,this.xhrHelper=n,this.videoSrc=e.initialVideo?this.getSrcForConfig(e.initialVideo):null,this.imageSrc=e.initialImage?this.getSrcForConfig(e.initialImage):null}preloadTexture(e,t,n){return i=this,r=void 0,s=function*(){const i=yield this.xhrHelper.loadBlobFromUrl(e,t,n);return window.URL.createObjectURL(i)},new((o=void 0)||(o=Promise))((function(e,t){function n(e){try{l(s.next(e))}catch(e){t(e)}}function a(e){try{l(s.throw(e))}catch(e){t(e)}}function l(t){var i;t.done?e(t.value):(i=t.value,i instanceof o?i:new o((function(e){e(i)}))).then(n,a)}l((s=s.apply(i,r||[])).next())}));var i,r,o,s}getTextureSrcFromAdaptiveConfig(e){if(this.detectorHelper.isMobileDevice()){if(void 0!==e.mobile)return e.mobile;if(void 0!==e.default)return e.default}if(this.detectorHelper.isTabletDevice()){if(void 0!==e.tablet)return e.tablet;if(void 0!==e.default)return e.default}if(void 0!==e.desktop)return e.desktop;if(void 0!==e.default)return e.default;throw new Error("Could not find any texture src for adaptive config.")}setVideoConfig(e){this.videoSrc=this.getSrcForConfig(e)}setVideoSrc(e){this.videoSrc=e}hasVideoSrc(){return null!==this.videoSrc}getVideoSrc(){if(null===this.videoSrc)throw new Error("No video src configured. Call hasVideoSrc() to check if a video src was provided.");return this.videoSrc}hasImageSrc(){return null!==this.imageSrc}getImageSrc(){if(null===this.imageSrc)throw new Error("No image src configured. Call hasImageSrc() to check if a image src was provided.");return this.imageSrc}getSrcForConfig(e){if(this.detectorHelper.isMobileDevice()){if(void 0!==e.mobile)return e.mobile;if(void 0!==e.default)return e.default}if(this.detectorHelper.isTabletDevice()){if(void 0!==e.tablet)return e.tablet;if(void 0!==e.default)return e.default}return void 0!==e.desktop?e.desktop:void 0!==e.default?e.default:null}}class K{constructor(e,t){this.fullscreenChangeEventCallbacks=[],this.container=e,this.fullscreenElement=t||e,this.registerFullscreenChangeEventListener()}getWidth(){return this.container.clientWidth}getHeight(){return this.container.clientHeight}getContainer(){return this.container}getOffsets(){const e=this.container.getBoundingClientRect();return{top:e.top,left:e.left}}addFullscreenChangeEventCallback(e){this.fullscreenChangeEventCallbacks.push(e)}isFullscreen(){return document.fullScreen||document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement}enterFullscreen(){this.isFullscreen()||this.enterFullscreenForElement(this.fullscreenElement)}leaveFullscreen(){this.isFullscreen()&&this.leaveFullscreenForDocument()}registerFullscreenChangeEventListener(){const e=()=>{const e=this.isFullscreen();for(let t of this.fullscreenChangeEventCallbacks)t(e)};document.addEventListener("fullscreenchange",e),document.addEventListener("webkitfullscreenchange",e),document.addEventListener("mozfullscreenchange",e),document.addEventListener("MSFullscreenChange",e)}enterFullscreenForElement(e){e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen&&e.msRequestFullscreen()}leaveFullscreenForDocument(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()}}class Q{constructor(e){this.moduleConfigs={},this.coreConfig=e}getCoreConfig(){return this.coreConfig}registerModuleConfig(e,t){if(void 0!==this.moduleConfigs[e])throw new Error("Config for module "+e+" already registered");this.moduleConfigs[e]=t}getModuleConfig(e){if(void 0===this.moduleConfigs[e])throw new Error("No config for module "+e+" registered");return this.moduleConfigs[e]}mergeAndValidateConfig(e,t,n){const i=Object.assign({},t);return this.mergeConfig(i,e),n.check(i),i}mergeConfig(e,t){for(let n in t)void 0!==e[n]&&void 0!==t[n]&&null!==t[n]&&("object"!=typeof e[n]||Array.isArray(e[n])?e[n]=t[n]:this.mergeConfig(e[n],t[n]))}}class ee{constructor(e){this.startupLogMessages=null,this.logger=e}error(e){this.logger.error(e)}info(e){this.logger.info(e)}getStartupLogMessages(){return null===this.startupLogMessages&&(this.startupLogMessages=this.logger.flushRecordedMessages()),this.startupLogMessages}}class te{constructor(e,t){this.instances={},this.registeredCreateFunctions={},this.container=e,this.coreConfig=t}getConfigHelper(){return this.getInstance("ConfigHelper",(()=>new Q(this.coreConfig)))}getDetectorHelper(){return this.getInstance("DetectorHelper",(()=>new U(new _)))}getDomHelper(){return this.getInstance("DomHelper",(()=>this.coreConfig.fullscreenElement?new K(this.container,this.coreConfig.fullscreenElement):new K(this.container)))}getEventHelper(){return this.getInstance("EventHelper",(()=>new w))}getFpsHelper(){return this.getInstance("FpsHelper",(()=>new B(this.coreConfig.minRequiredFps)))}getLogHelper(){return this.getInstance("LogHelper",(()=>new ee(c)))}getMathHelper(){return this.getInstance("MathHelper",(()=>new Y))}getPositionHelper(){return this.getInstance("PositionHelper",(()=>new G(this.getDomHelper())))}getTextureHelper(){return this.getInstance("TextureHelper",(()=>new Z(this.coreConfig,this.getDetectorHelper(),this.getXhrHelper())))}getWindowHelper(){return this.getInstance("WindowHelper",(()=>new X))}getXhrHelper(){return this.getInstance("XhrHelper",(()=>new $))}register(e,t){if(void 0!==this.registeredCreateFunctions[e])throw new Error("Helper with name "+e+" already registered.");this.registeredCreateFunctions[e]=t}get(e){if(void 0===this.registeredCreateFunctions[e])throw new Error("Helper with name "+e+" not registered.");return this.getInstance(e,this.registeredCreateFunctions[e])}getInstance(e,t){if(this.hasInstance(e))return this.instances[e];let n=t();return this.instances[e]=n,n}hasInstance(e){return void 0!==this.instances[e]}}var ne=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((i=i.apply(e,t||[])).next())}))};class ie{constructor(){this.onStartCallbacks=[]}registerOnStartCallback(e){this.onStartCallbacks.push(e)}load(e,t,n){return ne(this,void 0,void 0,(function*(){c.info("Load runtime");const i=new te(e,t),r=new N(e,t,i);this.initRuntime(i,r),yield m.initModules(i,r);for(let e of this.buildSteps(i,r))"function"==typeof n&&n(e.getId()),yield e.run();yield m.startModules(i,r)}))}start(){return ne(this,void 0,void 0,(function*(){c.info("Start runtime");for(let e of this.onStartCallbacks)yield e()}))}initRuntime(e,t){t.getStartupController().setRuntime(this),e.getDomHelper().getContainer().appendChild(t.getSceneController().getRenderer().domElement)}buildSteps(e,t){const n=[];return n.push(new x(t,e)),n.push(new v(t,e)),n.push(new L(t,e)),n}}var re=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((i=i.apply(e,t||[])).next())}))};Jarvis.core={loader:new class{constructor(){this.rawConfig={}}useModule(e,t,n){m.register(e,t,n)}configure(e){this.rawConfig=Object.assign(this.rawConfig,e)}onLoadError(e){this.loadErrorCallback=e}onLoadProgress(e){this.loadProgressCallback=e}onLoadEnd(e){this.loadEndCallback=e}addEventCallback(e){l.addEventCallback(e)}sendEvent(e,t){E.notifyAboutEvent(e,t)}loadInContainer(e){return re(this,void 0,void 0,(function*(){if(void 0===this.loadErrorCallback)throw new Error("No error callback provided. Call onLoadError(...) first.");try{const t=Date.now();c.startRecording();const n=this.initDomElement(e),i=this.mergeDefaultConfig(this.rawConfig);yield m.loadModules(),yield this.loadAndStartWebGLRuntime(n,i),this.measureLoadTimeAndDispatchLoadTimeEvent(t),c.stopRecording(),yield this.waitForLoadEndCallback()}catch(e){e instanceof f?l.dispatchErrorEventWithType(e.getErrorEventType()):l.dispatchErrorEventWithMessage(e),c.error(e),this.loadErrorCallback(e)}}))}initDomElement(e){const t=document.getElementById(e),n=document.createElement("div");if(n.classList.add(r.innerContainer),null===t)throw new Error("Could not locate element with id "+e);return t.appendChild(n),n}mergeDefaultConfig(e){const t=Object.assign({},h),n=new u;for(let n in e)void 0!==t[n]&&void 0!==e[n]&&null!==e[n]&&(t[n]=e[n]);return n.check(t),t}loadAndStartWebGLRuntime(e,t){return re(this,void 0,void 0,(function*(){const n=new ie;yield n.load(e,t,this.loadProgressCallback),yield n.start()}))}measureLoadTimeAndDispatchLoadTimeEvent(e){const t=(Date.now()-e)/1e3;c.info("Done loading Jarvis after "+t+" seconds"),l.dispatchMeasuredLoadTimeInSecondsEvent(t/1e3)}waitForLoadEndCallback(){return re(this,void 0,void 0,(function*(){void 0!==this.loadEndCallback&&(yield this.loadEndCallback())}))}}}})()})();